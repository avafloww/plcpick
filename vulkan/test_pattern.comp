#version 460
#extension GL_EXT_shader_explicit_arithmetic_types_int8 : require
#extension GL_EXT_shader_8bit_storage : require
#extension GL_EXT_shader_explicit_arithmetic_types_int64 : require
layout(local_size_x = 1) in;

#include "pattern.glsl"

layout(std430, set = 0, binding = 0) readonly buffer PatternBuf {
    uint8_t data[];
} buf_pattern;

layout(std430, set = 0, binding = 1) readonly buffer PatternLen {
    uint pat_len;
} buf_pat_len;

layout(std430, set = 0, binding = 2) readonly buffer TextBuf {
    uint8_t data[];
} buf_text;

layout(std430, set = 0, binding = 3) buffer ResultBuf {
    uint result;
} buf_result;

void main() {
    uint8_t pattern[24];
    uint8_t text[24];

    uint pl = buf_pat_len.pat_len;
    for (uint i = 0u; i < 24u; i++) {
        pattern[i] = (i < pl) ? buf_pattern.data[i] : uint8_t(0u);
        text[i] = buf_text.data[i];
    }

    bool matched = pattern_glob_match(pattern, pl, text, 24u);
    buf_result.result = matched ? 1u : 0u;
}
